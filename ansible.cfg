[defaults]
# 基础配置
inventory = ansible/inventory.yml
remote_user = deploy
host_key_checking = False

# SSH key 配置：
# - 本地开发：使用 SSH agent 或默认 key (~/.ssh/id_ed25519)
# - CI/CD：通过 ANSIBLE_SSH_PRIVATE_KEY_FILE 环境变量指定

# ==================== 性能优化 ====================

# SSH 连接复用（显著提升速度）
# 复用已建立的 SSH 连接，避免每个任务都重新连接
[ssh_connection]
pipelining = True
ssh_args = -o ControlMaster=auto -o ControlPersist=60s -o ControlPath=/tmp/ansible-ssh-%h-%p-%r

# 并发连接数（根据目标服务器数量调整）
forks = 10

# Fact 缓存（避免重复收集系统信息）
# 缓存 facts 1 小时，大幅提升重复运行速度
gathering = smart
fact_caching = jsonfile
fact_caching_connection = /tmp/ansible_facts
fact_caching_timeout = 3600

# 减少 SSH 连接超时等待时间
timeout = 30

# 禁用 cowsay（如果安装了的话）
nocows = 1

# 显示任务执行时间
callbacks_enabled = profile_tasks, timer

# ==================== 输出优化 ====================

# 简化输出，只显示重要信息
stdout_callback = yaml
bin_ansible_callbacks = True

# 显示跳过的任务
display_skipped_hosts = False

# ==================== 其他优化 ====================

# 提权配置（默认不提权，需要时在 task 中单独指定 become: yes）
[privilege_escalation]
become = False
become_method = sudo
become_ask_pass = False

# 重试配置
[connection]
retries = 3
